jQuery(document).ready(function(e){"use strict";function s(t,n){var r=t.val();if(r.length<6)return;if(n==="paste"||n.which<=90&&n.which>=48||n.which>=96&&n.which<=111||n.which==8||n.which==9||n.which==187||n.which==190){var i=t.attr("id");var s=t.parents(".cmb_metabox tr td");var o=e(".embed_status",s);var u=t.width();var a=e(":first-child",o);u=o.length&&a.length?a.width():t.width();e(".cmb-spinner",s).show();e(".embed_wrap",s).html("");setTimeout(function(){if(e(".cmb_oembed:focus").val()!=r)return;e.ajax({type:"post",dataType:"json",url:window.cmb_l10.ajaxurl,data:{action:"cmb_oembed_handler",oembed_url:r,oembed_width:u>300?u:300,field_id:i,object_id:window.cmb_l10.object_id,object_type:window.cmb_l10.object_type,cmb_ajax_nonce:window.cmb_l10.ajax_nonce},success:function(t){if(typeof t.id==="undefined")return;e(".cmb-spinner",s).hide();e(".embed_wrap",s).html(t.result)}})},500)}}function o(){e("table.cmb_metabox").each(function(t){var n=e(this);var r=n.parents(".inside");if(!r.length)return true;var i=r.width();var s=Math.round(i*.82*.97)-30;if(s>639)return true;var o=e(".cmb-type-oembed .embed_status",n).children().first();var u=o.width();var a=o.height();var f=Math.round(s*a/u);o.width(s).height(f)})}var t;var n={};var r=0;e(".cmb_timepicker").each(function(){e("#"+jQuery(this).attr("id")).timePicker({startTime:"07:00",endTime:"22:00",show24Hours:false,separator:":",step:30})});e(".cmb_datepicker").each(function(){e("#"+jQuery(this).attr("id")).datepicker()});e("#ui-datepicker-div").wrap('<div class="cmb_element" />');var i={palettes:["#A2DD00","#008ACF","#EC661C"]};if(typeof jQuery.wp==="object"&&typeof jQuery.wp.wpColorPicker==="function"){e("input:text.cmb_colorpicker").wpColorPicker(i)}else{e("input:text.cmb_colorpicker").each(function(t){e(this).after('<div id="picker-'+t+'" style="z-index: 1000; background: #EEE; border: 1px solid #CCC; position: absolute; display: block;"></div>');e("#picker-"+t).hide().farbtastic(e(this))}).focus(function(){e(this).next().show()}).blur(function(){e(this).next().hide()})}e(".cmb_metabox").on("change",".cmb_upload_file",function(){t=e(this).attr("name");e("#"+t+"_id").val("")}).on("click",".cmb_upload_button",function(r){r.preventDefault();var i=e(this);t=i.prev("input").attr("name");var s=e("#"+t);var o=true;var u=true;var a=i.hasClass("cmb_upload_list");if(t in n){n[t].open();return}n[t]=wp.media.frames.file_frame=wp.media({title:e("label[for="+t+"]").text(),button:{text:window.cmb_l10.upload_file},multiple:a?true:false});n[t].on("select",function(){if(a){u=n[t].state().get("selection").toJSON();s.val(u.url);e("#"+t+"_id").val(u.id);var r=[];e(u).each(function(){if(this.type&&this.type==="image"){o='<li class="img_status">'+'<img width="50" height="50" src="'+this.url+'" class="attachment-50x50" alt="'+this.filename+'">'+'<p><a href="#" class="cmb_remove_file_button" rel="'+t+"["+this.id+']">'+cmb_l10.remove_image+"</a></p>"+'<input type="hidden" id="filelist-'+this.id+'" name="'+t+"["+this.id+']" value="'+this.url+'">'+"</li>"}else{o="<li>"+cmb_l10.file+" <strong>"+this.filename+'</strong>&nbsp;&nbsp;&nbsp; (<a href="'+this.url+'" target="_blank" rel="external">'+cmb_l10.download+'</a> / <a href="#" class="cmb_remove_file_button" rel="'+t+"["+this.id+']">'+cmb_l10.remove_file+"</a>)"+'<input type="hidden" id="filelist-'+this.id+'" name="'+t+"["+this.id+']" value="'+this.url+'">'+"</li>"}r.push(o)});e(r).each(function(){s.siblings(".cmb_media_status").slideDown().append(this)})}else{u=n[t].state().get("selection").first().toJSON();s.val(u.url);e("#"+t+"_id").val(u.id);if(u.type&&u.type==="image"){o='<div class="img_status"><img style="max-width: 350px; width: 100%; height: auto;" src="'+u.url+'" alt="'+u.filename+'" title="'+u.filename+'" /><p><a href="#" class="cmb_remove_file_button" rel="'+t+'">'+cmb_l10.remove_image+"</a></p></div>"}else{o=cmb_l10.file+" <strong>"+u.filename+'</strong>&nbsp;&nbsp;&nbsp; (<a href="'+u.url+'" target="_blank" rel="external">'+cmb_l10.download+'</a> / <a href="#" class="cmb_remove_file_button" rel="'+t+'">'+cmb_l10.remove_file+"</a>)"}s.siblings(".cmb_media_status").slideDown().html(o)}});n[t].open()}).on("click",".cmb_remove_file_button",function(n){var r=e(this);if(r.is(".attach_list .cmb_remove_file_button")){r.parents("li").remove();return false}t=r.attr("rel");var i=r.parents(".img_status");e("input#"+t).val("");e("input#"+t+"_id").val("");if(!i.length){r.parents(".cmb_media_status").html("")}else{i.html("")}return false}).on("click",".add-row-button",function(t){t.preventDefault();self=e(this);var n="#"+self.data("selector");var i=e(n);var s=e(".empty-row",i).clone(true);s.removeClass("empty-row").addClass("repeat-row");s.insertBefore(n+" tbody>tr:last");var o=e("input.cmb_datepicker",s);var u=o.attr("id");o.attr("id",u+r);r++}).on("click",".remove-row-button",function(t){t.preventDefault();var n=e(this);var r=n.parents(".cmb-repeat-table");console.log("number of tbodys",r.length);console.log("number of trs",e("tr",r).length);if(e("tr",r).length>2)n.parents(".cmb-repeat-table tr").remove()}).on("keyup",".cmb_oembed",function(t){s(e(this),t)});e(".cmb_oembed").bind("paste",function(t){var n=e(this);setTimeout(function(){s(n,"paste")},100)}).blur(function(){setTimeout(function(){e(".postbox table.cmb_metabox .cmb-spinner").hide()},2e3)});setTimeout(o,500);e(window).on("resize",o)})